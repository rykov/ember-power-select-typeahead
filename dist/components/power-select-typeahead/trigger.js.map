{"version":3,"file":"trigger.js","sources":["../../../src/components/power-select-typeahead/trigger.hbs","../../../src/components/power-select-typeahead/trigger.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! template-lint-disable no-pointer-down-event-binding }}\\n<input type=\\\"search\\\"\\n  value={{this.text}}\\n  id=\\\"ember-power-select-typeahead-input-{{@select.uniqueId}}\\\"\\n  class=\\\"ember-power-select-typeahead-input ember-power-select-search-input\\\"\\n  autocomplete=\\\"off\\\"\\n  autocorrect=\\\"off\\\"\\n  autocapitalize=\\\"off\\\"\\n  spellcheck=\\\"false\\\"\\n  placeholder={{@placeholder}}\\n  oninput={{@onInput}}\\n  onfocus={{@onFocus}}\\n  onblur={{@onBlur}}\\n  disabled={{@select.disabled}}\\n  onkeydown={{this.handleKeydown}}\\n  onmousedown={{this.stopPropagation}}>\\n{{#if @select.loading}}\\n  <span class=\\\"ember-power-select-typeahead-loading-indicator\\\"></span>\\n{{/if}}\\n\")","/* eslint-disable ember/no-get, ember/no-observers */\nimport { addObserver, removeObserver } from '@ember/object/observers';\nimport { action, get, set } from '@ember/object';\nimport Component from '@glimmer/component';\nimport { schedule } from '@ember/runloop';\nimport { isBlank } from '@ember/utils';\n\nexport default class PowerSelectTypeaheadTrigger extends Component {\n  text = '';\n\n  constructor() {\n    super(...arguments);\n    addObserver(this, 'args.select', this, 'onUpdatedAttrs');\n    this.onUpdatedAttrs();\n  }\n\n  willDestroy() {\n    super.willDestroy(...arguments);\n    removeObserver(this, 'args.select', this, 'onUpdatedAttrs');\n  }\n\n  /**\n   * Pseudo-Lifecycle Hook\n   * power-select updates the state of the publicAPI (select) for every typeahead\n   * so we capture this as `state` via oldSelect && newSelect\n   *\n   * @private\n   * @method onUpdatedAttrs\n   */\n  @action onUpdatedAttrs() {\n    let oldSelect = this.oldSelect;\n    let newSelect = (this.oldSelect = get(this, 'args.select'));\n    if (!oldSelect) {\n      return;\n    }\n    /*\n     * We need to update the input field with value of the selected option whenever we're closing\n     * the select box.\n     */\n    if (oldSelect.isOpen && !newSelect.isOpen && newSelect.searchText) {\n      let input = document.querySelector(\n        `#ember-power-select-typeahead-input-${newSelect.uniqueId}`,\n      );\n      let newText = this.getSelectedAsText();\n      if (input.value !== newText) {\n        input.value = newText;\n      }\n      set(this, 'text', newText);\n    }\n\n    if (newSelect.lastSearchedText !== oldSelect.lastSearchedText) {\n      if (isBlank(newSelect.lastSearchedText)) {\n        schedule('actions', null, newSelect.actions.close, null, true);\n      } else {\n        schedule('actions', null, newSelect.actions.open);\n      }\n    }\n\n    if (oldSelect.selected !== newSelect.selected) {\n      set(this, 'text', this.getSelectedAsText());\n    }\n  }\n\n  /**\n   * on mousedown prevent propagation of event\n   *\n   * @private\n   * @method stopPropagation\n   * @param {Object} event\n   */\n  @action stopPropagation(e) {\n    e.stopPropagation();\n  }\n\n  /**\n   * called from power-select internals\n   *\n   * @private\n   * @method handleKeydown\n   * @param {Object} event\n   */\n  @action handleKeydown(e) {\n    // up or down arrow and if not open, no-op and prevent parent handlers from being notified\n    if ([38, 40].includes(e.keyCode) && !get(this, 'args.select.isOpen')) {\n      e.stopPropagation();\n      return;\n    }\n    let isLetter = (e.keyCode >= 48 && e.keyCode <= 90) || e.keyCode === 32; // Keys 0-9, a-z or SPACE\n    // if isLetter, escape or enter, prevent parent handlers from being notified\n    if (isLetter || [13, 27].includes(e.keyCode)) {\n      let select = get(this, 'args.select');\n      // open if loading msg configured\n      if (!select.isOpen && get(this, 'args.loadingMessage')) {\n        schedule('actions', null, select.actions.open);\n      }\n      e.stopPropagation();\n    }\n\n    // optional, passed from power-select\n    let onkeydown = get(this, 'args.onKeydown');\n    if (onkeydown && onkeydown(e) === false) {\n      return false;\n    }\n  }\n\n  /**\n   * obtains seleted value based on complex object or primitive value from power-select publicAPI\n   *\n   * @private\n   * @method getSelectedAsText\n   */\n  getSelectedAsText() {\n    let path = get(this, 'args.extra.labelPath');\n    let value = get(this, `args.select.selected${path ? `.${path}` : ''}`);\n    return value === undefined ? '' : value;\n  }\n}\n"],"names":["PowerSelectTypeaheadTrigger","Component","text","constructor","arguments","addObserver","onUpdatedAttrs","willDestroy","removeObserver","oldSelect","newSelect","get","isOpen","searchText","input","document","querySelector","uniqueId","newText","getSelectedAsText","value","set","lastSearchedText","isBlank","schedule","actions","close","open","selected","n","this","prototype","action","stopPropagation","e","handleKeydown","includes","keyCode","isLetter","select","onkeydown","path","undefined","setComponentTemplate","TEMPLATE"],"mappings":"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"}