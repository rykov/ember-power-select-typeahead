{"version":3,"file":"trigger.js","sources":["../../../src/components/power-select-typeahead/trigger.hbs","../../../src/components/power-select-typeahead/trigger.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! template-lint-disable no-pointer-down-event-binding }}\\n<input type=\\\"search\\\"\\n  value={{this.text}}\\n  id=\\\"ember-power-select-typeahead-input-{{@select.uniqueId}}\\\"\\n  class=\\\"ember-power-select-typeahead-input ember-power-select-search-input\\\"\\n  autocomplete=\\\"off\\\"\\n  autocorrect=\\\"off\\\"\\n  autocapitalize=\\\"off\\\"\\n  spellcheck=\\\"false\\\"\\n  placeholder={{@placeholder}}\\n  oninput={{@onInput}}\\n  onfocus={{@onFocus}}\\n  onblur={{@onBlur}}\\n  disabled={{@select.disabled}}\\n  onkeydown={{this.handleKeydown}}\\n  onmousedown={{this.stopPropagation}}>\\n{{#if @select.loading}}\\n  <span class=\\\"ember-power-select-typeahead-loading-indicator\\\"></span>\\n{{/if}}\\n\")","/* eslint-disable ember/no-observers */\nimport { addObserver, removeObserver } from '@ember/object/observers';\nimport { task, waitForQueue } from 'ember-concurrency';\nimport { tracked } from '@glimmer/tracking';\nimport Component from '@glimmer/component';\nimport { isBlank } from '@ember/utils';\nimport { action } from '@ember/object';\n\nexport default class PowerSelectTypeaheadTrigger extends Component {\n  @tracked text = '';\n\n  constructor() {\n    super(...arguments);\n    addObserver(this, 'args.select', this, 'onUpdatedAttrs');\n    this.onUpdatedAttrs();\n  }\n\n  willDestroy() {\n    super.willDestroy(...arguments);\n    removeObserver(this, 'args.select', this, 'onUpdatedAttrs');\n  }\n\n  /**\n   * Pseudo-Lifecycle Hook\n   * power-select updates the state of the publicAPI (select) for every typeahead\n   * so we capture this as `state` via oldSelect && newSelect\n   *\n   * @private\n   * @method onUpdatedAttrs\n   */\n  @action onUpdatedAttrs() {\n    let oldSelect = this.oldSelect;\n    let newSelect = (this.oldSelect = this.args.select);\n    if (!oldSelect) {\n      this.text = this.getSelectedAsText();\n      return;\n    }\n    /*\n     * We need to update the input field with value of the selected option whenever we're closing\n     * the select box.\n     */\n    if (oldSelect.isOpen && !newSelect.isOpen && newSelect.searchText) {\n      let input = document.querySelector(\n        `#ember-power-select-typeahead-input-${newSelect.uniqueId}`,\n      );\n      let newText = this.getSelectedAsText();\n      if (input.value !== newText) {\n        input.value = newText;\n      }\n      this.text = newText;\n    }\n\n    if (newSelect.lastSearchedText !== oldSelect.lastSearchedText) {\n      const toClose = isBlank(newSelect.lastSearchedText);\n      this.selectActionTask.perform(newSelect, toClose);\n    }\n\n    if (oldSelect.selected !== newSelect.selected) {\n      this.text = this.getSelectedAsText();\n    }\n  }\n\n  /**\n   * on mousedown prevent propagation of event\n   *\n   * @private\n   * @method stopPropagation\n   * @param {Object} event\n   */\n  @action stopPropagation(e) {\n    e.stopPropagation();\n  }\n\n  /**\n   * called from power-select internals\n   *\n   * @private\n   * @method handleKeydown\n   * @param {Object} event\n   */\n  @action handleKeydown(e) {\n    const select = this.args.select;\n\n    // up or down arrow and if not open, no-op and prevent parent handlers from being notified\n    if ([38, 40].includes(e.keyCode) && !select.isOpen) {\n      e.stopPropagation();\n      return;\n    }\n    let isLetter = (e.keyCode >= 48 && e.keyCode <= 90) || e.keyCode === 32; // Keys 0-9, a-z or SPACE\n    // if isLetter, escape or enter, prevent parent handlers from being notified\n    if (isLetter || [13, 27].includes(e.keyCode)) {\n      // open if loading msg configured\n      if (!select.isOpen && this.args.loadingMessage) {\n        this.selectActionTask.perform(select, false);\n      }\n      e.stopPropagation();\n    }\n\n    // optional, passed from power-select\n    let onkeydown = this.args.onKeydown;\n    if (onkeydown && onkeydown(e) === false) {\n      return false;\n    }\n  }\n\n  /**\n   * obtains seleted value based on complex object or primitive value from power-select publicAPI\n   *\n   * @private\n   * @method getSelectedAsText\n   */\n  getSelectedAsText() {\n    const path = this.args.extra?.labelPath;\n    let value = this.args.select.selected;\n    if (path && value) value = value[path];\n    return value === undefined ? '' : value;\n  }\n\n  /**\n   * Schedules open/close action on Select API\n   *\n   * @private\n   * @method selectActionTask\n   */\n  selectActionTask = task({ enqueue: true }, async ({ actions }, toClose) => {\n    await waitForQueue('actions');\n    toClose ? actions.close(null, true) : actions.open();\n  });\n}\n"],"names":["PowerSelectTypeaheadTrigger","Component","g","this","prototype","tracked","i","void 0","constructor","arguments","addObserver","onUpdatedAttrs","willDestroy","removeObserver","oldSelect","newSelect","args","select","text","getSelectedAsText","isOpen","searchText","input","document","querySelector","uniqueId","newText","value","lastSearchedText","toClose","isBlank","selectActionTask","perform","selected","n","action","stopPropagation","e","handleKeydown","includes","keyCode","isLetter","loadingMessage","onkeydown","onKeydown","path","extra","labelPath","undefined","_buildTask","context","generator","actions","waitForQueue","close","open","enqueue","setComponentTemplate","TEMPLATE"],"mappings":"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"}